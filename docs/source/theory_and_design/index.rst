Theory and test pattern design
==============================

This part of the documentation describes the underlying theory and techniques
used by this software, some of which are original.

The objective of this software is to ensure implementations of VC-2 use a
sufficient number of bits in their arithmetic to avoid integer wrap-around or
saturation errors. Such errors would be catastrophic for a lossless codec or
produce additional, unnecessary distortion in lossy codecs. The illustration
below shows an (exaggerated) example the effects of insufficient bit depths on
a VC-2 codec implementation:

.. image:: /_static/wrap_around_artefacts.svg
    :alt: Example of the effects of an insufficient number of bits on decoded pictures.

Though the Discrete Wavelet Transform (DWT) underlying VC-2 is linear, the
integer approximation used along with the use of quantisation for data-rate
reduction make VC-2 a non-linear filter. Computing the exact worst-case signal
ranges for non-linear filters (and therefore the number of bits required) is
not practical in general. Instead, as discussed in :ref:`theory-related-work`,
implementers typically resort to either wasteful over-allocation or error-prone
empirical testing to determine the number of bits required.

This software uses Affine Arithmetic (AA), as described in
:ref:`theory-affine-arithmetic`, to find hard upper-bounds on signal ranges.
While AA-based bounds are guaranteed not to under-estimate the true signal
range, they typically over-estimate the true signal range.

The magnitude of the over-estimates produced by AA is strongly related to the
magnitude of the non-linearity in the filter. In an analysis filter, for
example, the only non-linearities arise from rounding errors which tend to be
small, making the AA over-estimate small as well. Quantisation, however, can
introduce substantial errors and so post-quantisation, AA tends to produce
fairly large over-estimates. This effect is quantified in
:ref:`theory-affine-arithmetic-quantisation`.

In :ref:`theory-quantisation-proof`, an original refinement to the way the
worst-base bounds of VC-2's quantiser are calculated is presented which reduces
the over-estimates produced by AA.

Since AA produces large over-estimates for the number of bits required by a
synthesis filter, this software also attempts to generate synthetic test
patterns which elicit near-worst-case signal values. These test signals are
generated by an original heuristic described in :ref:`theory-test-patterns`.
These test patterns have been found to produce significantly larger signal
values than natural images or random noise in practice in experiments described
in :ref:`theory-results`.



.. toctree::
    :maxdepth: 2
    :caption: Contents:
    
    related_work
    aa_integer_arithmetic
    aa_quantisation
    quantisation_proof
    test_patterns
